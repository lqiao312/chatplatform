
<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DesignFTW • Remote Chat</title>

  <script type="importmap">
  {
    "imports": {
      "vue": "https://cdn.jsdelivr.net/npm/vue@3.5.13/dist/vue.esm-browser.js",
      "@graffiti-garden/implementation-remote": "https://cdn.jsdelivr.net/npm/@graffiti-garden/implementation-remote@0.6.2/dist/browser/index.js",
      "@graffiti-garden/wrapper-vue": "https://cdn.jsdelivr.net/npm/@graffiti-garden/wrapper-vue@0.7.2/dist/browser/plugin.mjs",
      "@graffiti-garden/modal": "https://cdn.jsdelivr.net/npm/@graffiti-garden/modal@0.4.1/dist/browser/index.js",
      "@inrupt/solid-client-authn-browser": "https://cdn.jsdelivr.net/npm/@inrupt/solid-client-authn-browser@2.1.3/dist/solid-client-authn-browser.esm.js"
    }
  }
  </script>

  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@graffiti-garden/modal@0.4.1/dist/browser/modal.css" />
</head>
<body>
  <div id="app">
    <h1>DesignFTW</h1>

    <button v-if="!$graffitiSession.value" @click="$graffiti.login()">Log In</button>
    <button v-else @click="$graffiti.logout($graffitiSession.value)">Log Out</button>
    <p v-if="$graffitiSession.value">Logged in as <username-display :actor="$graffitiSession.value.actor" /></p>

    
<template v-if="$graffitiSession.value">
  <div class="top-right">
    <button @click="showProfileEditor = !showProfileEditor; if (!showProfileEditor) scrollToProfile()">Profile</button>
  </div>

      <div class="chat-container">
        <aside class="chat-sidebar">
          <h2>Create Group</h2>
          <form @submit.prevent="createGroupChat($graffitiSession.value)">
            <input v-model="newGroupName" placeholder="Group name" />
            <button type="submit">Create</button>
          </form>

          <h2>Groups</h2>
            <graffiti-discover
            v-slot="{ objects: groups }"
            :channels="['designftw']"
            :schema="createSchema"
            >
            <ul>
                <li v-for="g in groups" :key="g.url">
                <button @click="enterGroup(g)">
                    {{ g.value.object.name }}
                </button>
                </li>
            </ul>
            </graffiti-discover>
        </aside>

        <main class="chat-main" v-if="currentGroup">
          <header class="group-header">
            <h2>{{ groupName }}</h2>
            <form @submit.prevent="setGroupNameOverride($graffitiSession.value)">
                <input v-model="editGroupName" placeholder="Rename…" />
                <button type="submit">Save</button>
            </form>
          </header>

          <form @submit.prevent="sendMessage($graffitiSession.value)">
            <input v-model="myMessage" placeholder="Message" />
            <button type="submit">Send</button>
          </form>

          <graffiti-discover
            v-slot="{ objects: msgs }"
            :channels="channels"
            :schema="msgSchema"
          >
            <ul class="message-list">
              <li v-for="m in msgs.sort((a,b)=>a.value.published-b.value.published)" :key="m.url">
                <template v-if="editingMessage === m">
                  <input
                    class="message-content"
                    v-model="editedContent"
                    @keyup.enter="editMessage(m, editedContent, $graffitiSession.value)"
                  />
                  <div class="message-actions">
                    <button @click="editMessage(m, editedContent, $graffitiSession.value)">Save</button>
                    <button @click="editingMessage = null">Cancel</button>
                  </div>
                </template>
                <template v-else>
                  <div class="message-content">
  <div class="message-header">
    <username-display :actor="m.actor" />
    <small>· {{ new Date(m.value.published).toLocaleTimeString() }}</small>
  </div>
  <div class="message-body">
    <span>{{ m.value.content }}</span>
  </div>
</div>
                  <div class="message-actions" v-if="m.actor === $graffitiSession.value.actor">
                    <button @click="editingMessage = m; editedContent = m.value.content">Edit</button>
                    <button @click="deleteMessage(m, $graffitiSession.value)">Delete</button>
                  </div>
                </template>
              </li>
            </ul>
          </graffiti-discover>
        </main>
      </div>
      <div id="profile-editor" class="profile-editor" v-if="showProfileEditor">
  <h2>Edit Profile</h2>
  <input v-model="profile.name" placeholder="Name" />
  <input v-model="profile.pronouns" placeholder="Pronouns" />
  <input v-model="profile.describes" placeholder="Describes (link)" />
  <button @click="saveProfile">Save Profile</button>
  <div>
    <h3>Current Profile</h3>
    <p><strong>Name:</strong> {{ profile.name }}</p>
    <p><strong>Pronouns:</strong> {{ profile.pronouns }}</p>
    <p><strong>Describes:</strong> {{ profile.describes }}</p>
  </div>
</div>
    </template>
  </div>

  <script type="module" src="./index.js"></script>
</body>
</html>
